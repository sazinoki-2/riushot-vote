<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Vote</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.13.5/ethers.umd.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="container">
        <div class="container">
            <!-- Header -->
            <header>
                <div class="branding">
                    <img src="RDGTaikon.png" alt="Logo" class="site-logo">
                    <h1>RIUDAO GOVERNANCE</h1>
                </div>

                <div class="wallet-container">
                    <div id="wallet-stats" class="wallet-stats">
                        <span id="wallet-address" class="wallet-address"></span>
                        <span id="wallet-balance" class="wallet-balance"></span>
                    </div>
                    <button id="connect-btn" class="btn btn-primary" onclick="connectWallet()">Connect Wallet</button>
                </div>
            </header>

            <!-- Controls -->
            <div class="controls-bar">
                <h2 style="font-size:18px; font-weight:500">投票一覧</h2>
                <button id="create-btn" class="btn btn-primary" onclick="openModal()" disabled>+ Create
                    Proposal</button>
            </div>

            <!-- Proposals List -->
            <div id="proposals-container">
                <!-- Injected by JS -->
            </div>

        </div>

        <!-- Create Modal -->
        <div id="create-modal" class="modal-overlay">
            <div class="modal">
                <h3 class="modal-title">提案を作成</h3>

                <div class="form-group">
                    <label>タイトル</label>
                    <input type="text" id="p-title" class="form-input" placeholder="例：報酬プールの増額案について">
                </div>

                <div class="form-group">
                    <label>提案内容</label>
                    <textarea id="p-desc" class="form-textarea" placeholder="提案の理由や詳細をここに書いてください。"></textarea>
                </div>

                <div class="modal-actions">
                    <button class="btn" onclick="closeModal()">キャンセル</button>
                    <button class="btn btn-primary" onclick="handleSubmitProposal()">公開</button>
                </div>
            </div>
        </div>

        <!-- Firebase SDK -->
        <script type="module">
            import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
            import { getDatabase, ref, set, push, onValue, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

            const firebaseConfig = {
                apiKey: "AIzaSyApIM3BiyhfvKq-3FBQ-BriQKjvAKOLTLM",
                authDomain: "riudao-vote.firebaseapp.com",
                databaseURL: "https://riudao-vote-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "riudao-vote",
                storageBucket: "riudao-vote.firebasestorage.app",
                messagingSenderId: "898511253134",
                appId: "1:898511253134:web:cc02f464974e0b2c8763df"
            };

            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);

            // Expose to global scope for script.js
            window.firebaseDB = database;
            window.firebaseRef = ref;
            window.firebaseSet = set;
            window.firebasePush = push;
            window.firebaseOnValue = onValue;
            window.firebaseUpdate = update;
        </script>
        <script src="script.js"></script>
</body>

</html>